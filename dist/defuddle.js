!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Defuddle=e():t.Defuddle=e()}(this,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{Defuddle:()=>s});class r{static extract(t,e){var r;let o="",n="";try{n=(null===(r=t.location)||void 0===r?void 0:r.href)||"",n&&(o=new URL(n).hostname.replace(/^www\./,""))}catch(e){const r=t.querySelector("base[href]");if(r)try{n=r.getAttribute("href")||"",o=new URL(n).hostname.replace(/^www\./,"")}catch(t){console.warn("Failed to parse base URL:",t)}}return{title:this.getTitle(t,e),description:this.getDescription(t,e),domain:o,favicon:this.getFavicon(t,n),image:this.getImage(t,e),published:this.getPublished(t,e),author:this.getAuthor(t,e),site:this.getSite(t,e),schemaOrgData:e}}static getAuthor(t,e){return this.getMetaContent(t,"name","sailthru.author")||this.getSchemaProperty(e,"author.name")||this.getMetaContent(t,"property","author")||this.getMetaContent(t,"name","byl")||this.getMetaContent(t,"name","author")||this.getMetaContent(t,"name","authorList")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(e,"copyrightHolder.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(e,"publisher.name")||this.getSchemaProperty(e,"sourceOrganization.name")||this.getSchemaProperty(e,"isPartOf.name")||this.getMetaContent(t,"name","twitter:creator")||this.getMetaContent(t,"name","application-name")||""}static getSite(t,e){return this.getSchemaProperty(e,"publisher.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(e,"sourceOrganization.name")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(e,"copyrightHolder.name")||this.getSchemaProperty(e,"isPartOf.name")||this.getMetaContent(t,"name","application-name")||""}static getTitle(t,e){var r,o;return this.getMetaContent(t,"property","og:title")||this.getMetaContent(t,"name","twitter:title")||this.getSchemaProperty(e,"headline")||this.getMetaContent(t,"name","title")||this.getMetaContent(t,"name","sailthru.title")||(null===(o=null===(r=t.querySelector("title"))||void 0===r?void 0:r.textContent)||void 0===o?void 0:o.trim())||""}static getDescription(t,e){return this.getMetaContent(t,"name","description")||this.getMetaContent(t,"property","description")||this.getMetaContent(t,"property","og:description")||this.getSchemaProperty(e,"description")||this.getMetaContent(t,"name","twitter:description")||this.getMetaContent(t,"name","sailthru.description")||""}static getImage(t,e){return this.getMetaContent(t,"property","og:image")||this.getMetaContent(t,"name","twitter:image")||this.getSchemaProperty(e,"image.url")||this.getMetaContent(t,"name","sailthru.image.full")||""}static getFavicon(t,e){var r,o;const n=this.getMetaContent(t,"property","og:image:favicon");if(n)return n;const a=null===(r=t.querySelector("link[rel='icon']"))||void 0===r?void 0:r.getAttribute("href");if(a)return a;const i=null===(o=t.querySelector("link[rel='shortcut icon']"))||void 0===o?void 0:o.getAttribute("href");if(i)return i;if(e)try{return new URL("/favicon.ico",e).href}catch(t){console.warn("Failed to construct favicon URL:",t)}return""}static getPublished(t,e){return this.getSchemaProperty(e,"datePublished")||this.getMetaContent(t,"name","publishDate")||this.getMetaContent(t,"property","article:published_time")||this.getTimeElement(t)||this.getMetaContent(t,"name","sailthru.date")||""}static getMetaContent(t,e,r){var o,n;const a=`meta[${e}]`,i=Array.from(t.querySelectorAll(a)).find((t=>{var o;return(null===(o=t.getAttribute(e))||void 0===o?void 0:o.toLowerCase())===r.toLowerCase()})),s=i&&null!==(n=null===(o=i.getAttribute("content"))||void 0===o?void 0:o.trim())&&void 0!==n?n:"";return this.decodeHTMLEntities(s)}static getTimeElement(t){var e,r,o,n;const a=Array.from(t.querySelectorAll("time"))[0],i=a&&null!==(n=null!==(r=null===(e=a.getAttribute("datetime"))||void 0===e?void 0:e.trim())&&void 0!==r?r:null===(o=a.textContent)||void 0===o?void 0:o.trim())&&void 0!==n?n:"";return this.decodeHTMLEntities(i)}static decodeHTMLEntities(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}static getSchemaProperty(t,e,r=""){if(!t)return r;const o=(t,e,r,n=!0)=>{if("string"==typeof t)return 0===e.length?[t]:[];if(!t||"object"!=typeof t)return[];if(Array.isArray(t)){const a=e[0];if(/^\[\d+\]$/.test(a)){const i=parseInt(a.slice(1,-1));return t[i]?o(t[i],e.slice(1),r,n):[]}return 0===e.length&&t.every((t=>"string"==typeof t||"number"==typeof t))?t.map(String):t.flatMap((t=>o(t,e,r,n)))}const[a,...i]=e;if(!a)return"string"==typeof t?[t]:"object"==typeof t&&t.name?[t.name]:[];if(t.hasOwnProperty(a))return o(t[a],i,r?`${r}.${a}`:a,!0);if(!n){const n=[];for(const a in t)if("object"==typeof t[a]){const i=o(t[a],e,r?`${r}.${a}`:a,!1);n.push(...i)}if(n.length>0)return n}return[]};try{let n=o(t,e.split("."),"",!0);0===n.length&&(n=o(t,e.split("."),"",!1));const a=n.length>0?n.filter(Boolean).join(", "):r;return this.decodeHTMLEntities(a)}catch(t){return console.error(`Error in getSchemaProperty for ${e}:`,t),r}}static extractSchemaOrgData(t){const e=t.querySelectorAll('script[type="application/ld+json"]'),r=[];return e.forEach((t=>{let e=t.textContent||"";try{e=e.replace(/\/\*[\s\S]*?\*\/|^\s*\/\/.*$/gm,"").replace(/^\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*$/,"$1").replace(/^\s*(\*\/|\/\*)\s*|\s*(\*\/|\/\*)\s*$/g,"").trim();const t=JSON.parse(e);t["@graph"]&&Array.isArray(t["@graph"])?r.push(...t["@graph"]):r.push(t)}catch(t){console.error("Error parsing schema.org data:",t),console.error("Problematic JSON content:",e)}})),r}}const o=["[hidden]",'[style*="display: none"]','[style*="display:none"]','[style*="visibility: hidden"]','[style*="visibility:hidden"]',".hidden",".invisible"].join(","),n=new Set(["href","src","srcset","data-src","data-srcset","alt","title","id","class","width","height","colspan","rowspan","headers","aria-label","role","lang"]),a=["#toc",".toc","#comments","#siteSub",".ad","aside","button","canvas","dialog","fieldset","footer","form","header","input","iframe","label","link","nav","noscript","option","script","select","sidebar",".sidebar","#sidebar","style","textarea",'[data-link-name*="skip"]','[src*="author"]','[href="#site-content"]','[class^="ad-"]','[class$="-ad"]','[id^="ad-"]','[id$="-ad"]','[role="banner"]','[role="dialog"]','[role="complementary"]','[role="navigation"]'],i=["avatar","-ad-","_ad_","article-end ","article-title","author","banner","bottom-of-article","brand-bar","breadcrumb","button","btn-","-btn","byline","catlinks","collections","comments","comment-content","complementary","-cta","cta-","discussion","eyebrow","expand-reduce","facebook","feedback","fixed","footer","for-you","global","google","goog-","interlude","link-box","loading","logo-","menu-","meta-","metadata","more-","mw-editsection","mw-jump-link","nav-","navbar","next-","newsletter-signup","overlay","popular","popup","post-date","post-title","post_date","post_title","preview","prevnext","profile","promo","qr-code","qr_code","read-next","reading-list","recommend","recirc","register","related","screen-reader-text","share","site-index","skip-","social","sponsor","subscribe","-toc","table-of-contents","tabs-","toolbar","top-wrapper","tree-item","trending","twitter"];class s{static enableDebug(t=!0){this.debug=t}static log(...t){this.debug&&console.log("Defuddle:",...t)}static parse(t){try{const e=this.evaluateMediaQueries(t),o=this.findSmallImages(t),n=t.cloneNode(!0),a=r.extractSchemaOrgData(t);this.applyMobileStyles(n,e);const i=this.findMainContent(n);if(!i)return Object.assign({content:t.body.innerHTML},r.extract(t,a));this.removeSmallImages(n,o),this.removeHiddenElements(n),this.removeClutter(n),this.cleanContent(i);const s=r.extract(t,a);return Object.assign({content:i?i.outerHTML:t.body.innerHTML},s)}catch(e){console.error("Defuddle","Error processing document:",e);const o=r.extractSchemaOrgData(t);return Object.assign({content:t.body.innerHTML},r.extract(t,o))}}static evaluateMediaQueries(t){const e=[];try{Array.from(t.styleSheets).filter((t=>{try{return t.cssRules,!0}catch(t){return!1}})).forEach((t=>{try{Array.from(t.cssRules).forEach((t=>{var r;t instanceof CSSMediaRule&&t.conditionText.includes("max-width")&&600<=parseInt((null===(r=t.conditionText.match(/\d+/))||void 0===r?void 0:r[0])||"0")&&Array.from(t.cssRules).forEach((t=>{if(t instanceof CSSStyleRule)try{e.push({selector:t.selectorText,styles:t.style.cssText})}catch(e){console.error("Defuddle","Error collecting styles for selector:",t.selectorText,e)}}))}))}catch(t){console.error("Defuddle","Error processing stylesheet:",t)}}))}catch(t){console.error("Defuddle","Error evaluating media queries:",t)}return e}static applyMobileStyles(t,e){e.forEach((({selector:e,styles:r})=>{try{t.querySelectorAll(e).forEach((t=>{t.setAttribute("style",(t.getAttribute("style")||"")+r)}))}catch(t){console.error("Defuddle","Error applying styles for selector:",e,t)}}))}static removeHiddenElements(t){let e=0;t.querySelectorAll(this.HIDDEN_ELEMENTS_SELECTOR).forEach((t=>{t.remove(),e++}));const r=t.getElementsByTagName("*");Array.from(r).forEach((t=>{const r=window.getComputedStyle(t);"none"!==r.display&&"hidden"!==r.visibility&&"0"!==r.opacity||(t.remove(),e++)})),this.log("Removed hidden elements:",e)}static removeClutter(t){let e=0,r=0;const o=a.map((t=>t.includes("[")?t.split(/(\[.*?\])/).map((t=>{if(t.startsWith("[")&&t.includes("=")){const[e,r]=t.slice(1,-1).split("=");if(r.startsWith('"')||r.startsWith("'"))return`[${e.toLowerCase()}=${r}]`}return t.toLowerCase()})).join(""):t.toLowerCase())).join(",");t.querySelectorAll(o).forEach((t=>{(null==t?void 0:t.parentNode)&&(t.remove(),e++)}));const n=i.map((t=>new RegExp(t,"i"))),s=new Set;t.querySelectorAll("[class], [id], [data-testid], [data-qa]").forEach((t=>{var e,o;if(!t||!t.parentNode)return;const a=`${t.className&&"string"==typeof t.className?t.className.toLowerCase():""} ${t.id?t.id.toLowerCase():""} ${(null===(e=t.getAttribute("data-testid"))||void 0===e?void 0:e.toLowerCase())||""} ${(null===(o=t.getAttribute("data-qa"))||void 0===o?void 0:o.toLowerCase())||""}`;n.some((t=>t.test(a)))&&(s.add(t),r++)})),s.forEach((t=>t.remove())),this.log("Found clutter elements:",{basicSelectors:e,patternMatches:r,total:e+r})}static cleanContent(t){this.removeHtmlComments(t),this.handleHeadings(t),this.stripUnwantedAttributes(t),this.removeEmptyElements(t)}static handleHeadings(t){const e=t.getElementsByTagName("h1");let r=!0;Array.from(e).forEach((t=>{var e;if(r)t.remove(),r=!1;else{const r=document.createElement("h2");r.innerHTML=t.innerHTML,Array.from(t.attributes).forEach((t=>{this.ALLOWED_ATTRIBUTES.has(t.name)&&r.setAttribute(t.name,t.value)})),null===(e=t.parentNode)||void 0===e||e.replaceChild(r,t)}}))}static removeHtmlComments(t){const e=[],r=document.createTreeWalker(t,NodeFilter.SHOW_COMMENT,null);let o;for(;o=r.nextNode();)e.push(o);e.forEach((t=>{t.remove()})),this.log("Removed HTML comments:",e.length)}static stripUnwantedAttributes(t){let e=0;const r=t=>{Array.from(t.attributes).forEach((r=>{const o=r.name.toLowerCase();this.ALLOWED_ATTRIBUTES.has(o)||o.startsWith("data-")||(t.removeAttribute(r.name),e++)}))};r(t),t.querySelectorAll("*").forEach(r),this.log("Stripped attributes:",e)}static removeEmptyElements(t){let e=0,r=0,o=!0;const n=new Set(["area","audio","base","br","col","embed","figure","hr","iframe","img","input","link","meta","object","param","picture","source","svg","td","th","track","video","wbr"]);for(;o;){r++,o=!1;const a=Array.from(t.getElementsByTagName("*")).filter((t=>{var e;if(n.has(t.tagName.toLowerCase()))return!1;const r=0===(null===(e=t.textContent)||void 0===e?void 0:e.trim().length),o=!t.hasChildNodes()||Array.from(t.childNodes).every((t=>{var e;return t.nodeType===Node.TEXT_NODE&&0===(null===(e=t.textContent)||void 0===e?void 0:e.trim().length)}));return r&&o}));a.length>0&&(a.forEach((t=>{t.remove(),e++})),o=!0)}this.log("Removed empty elements:",{count:e,iterations:r})}static findSmallImages(t){let e=0;const r=new Set,o=t.getElementsByTagName("img");return Array.from(o).forEach((t=>{var o;try{const n=window.getComputedStyle(t),a=t.naturalWidth||0,i=t.naturalHeight||0,s=parseInt(t.getAttribute("width")||"0"),l=parseInt(t.getAttribute("height")||"0"),c=parseInt(n.width)||0,m=parseInt(n.height)||0,d=t.getBoundingClientRect(),h=d.width,g=d.height,u=n.transform,p=u?parseFloat((null===(o=u.match(/scale\(([\d.]+)\)/))||void 0===o?void 0:o[1])||"1"):1,f=h*p,y=g*p,E=Math.min(...[a,s,c,f].filter((t=>t>0))),v=Math.min(...[i,l,m,y].filter((t=>t>0)));if(E>0&&v>0&&(E<24||v<24)){const o=this.getImageIdentifier(t);o&&(r.add(o),e++)}}catch(t){console.error("Error processing image:",t)}})),this.log("Found small images:",e),r}static removeSmallImages(t,e){let r=0;const o=t.getElementsByTagName("img");Array.from(o).forEach((t=>{const o=this.getImageIdentifier(t);o&&e.has(o)&&(t.remove(),r++)})),this.log("Removed small images:",r)}static getImageIdentifier(t){const e=t.src||t.getAttribute("data-src")||"",r=t.srcset||t.getAttribute("data-srcset")||"",o=t.alt||"",n=t.className||"",a=t.id||"";return e?`src:${e}`:r?`srcset:${r}`:a?`id:${a}`:n&&o?`class:${n};alt:${o}`:null}static findMainContent(t){const e=["article",'[role="article"]','[itemprop="articleBody"]',".post-content",".article-content","#article-content",".content-article","main",'[role="main"]',"body"],r=[];return e.forEach(((o,n)=>{t.querySelectorAll(o).forEach((t=>{let o=10*(e.length-n);o+=this.scoreElement(t),r.push({element:t,score:o})}))})),0===r.length?this.findContentByScoring(t):(r.sort(((t,e)=>e.score-t.score)),this.debug&&this.log("Content candidates:",r.map((t=>({element:t.element.tagName,selector:this.getElementSelector(t.element),score:t.score})))),r[0].element)}static findContentByScoring(t){const e=this.scoreElements(t);return e.length>0?e[0].element:null}static getElementSelector(t){const e=[];let r=t;for(;r&&r!==document.documentElement;){let t=r.tagName.toLowerCase();r.id?t+="#"+r.id:r.className&&(t+="."+r.className.trim().split(/\s+/).join(".")),e.unshift(t),r=r.parentElement}return e.join(" > ")}static scoreElements(t){const e=[];return this.BLOCK_ELEMENTS.forEach((r=>{Array.from(t.getElementsByTagName(r)).forEach((t=>{const r=this.scoreElement(t);r>0&&e.push({score:r,element:t})}))})),e.sort(((t,e)=>e.score-t.score))}static scoreElement(t){let e=0;const r=t.className.toLowerCase(),o=t.id.toLowerCase();(this.POSITIVE_PATTERNS.test(r)||this.POSITIVE_PATTERNS.test(o))&&(e+=25),(this.NEGATIVE_PATTERNS.test(r)||this.NEGATIVE_PATTERNS.test(o))&&(e-=25);const n=t.textContent||"",a=n.split(/\s+/).length;e+=Math.min(Math.floor(a/100),3);const i=t.getElementsByTagName("a"),s=Array.from(i).reduce(((t,e)=>{var r;return t+((null===(r=e.textContent)||void 0===r?void 0:r.length)||0)}),0);(n.length?s/n.length:0)>.5&&(e-=10),e+=t.getElementsByTagName("p").length;const l=t.getElementsByTagName("img").length;return e+=Math.min(3*l,9),e}}return s.debug=!0,s.POSITIVE_PATTERNS=/article|content|main|post|body|text|blog|story/i,s.NEGATIVE_PATTERNS=/comment|meta|footer|footnote|foot|nav|sidebar|banner|ad|popup|menu/i,s.BLOCK_ELEMENTS=["div","section","article","main"],s.HIDDEN_ELEMENTS_SELECTOR=o,s.ALLOWED_ATTRIBUTES=n,window.Defuddle=s,e.Defuddle})()));