!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Defuddle=e():t.Defuddle=e()}(this,(()=>(()=>{"use strict";var t={};class e{static extract(t,e){var r;let o="",n="";try{n=(null===(r=t.location)||void 0===r?void 0:r.href)||"",n&&(o=new URL(n).hostname.replace(/^www\./,""))}catch(e){const r=t.querySelector("base[href]");if(r)try{n=r.getAttribute("href")||"",o=new URL(n).hostname.replace(/^www\./,"")}catch(t){console.warn("Failed to parse base URL:",t)}}return{title:this.getTitle(t,e),description:this.getDescription(t,e),domain:o,favicon:this.getFavicon(t,n),image:this.getImage(t,e),published:this.getPublished(t,e),author:this.getAuthor(t,e),site:this.getSite(t,e),schemaOrgData:e}}static getAuthor(t,e){return this.getMetaContent(t,"name","sailthru.author")||this.getSchemaProperty(e,"author.name")||this.getMetaContent(t,"property","author")||this.getMetaContent(t,"name","byl")||this.getMetaContent(t,"name","author")||this.getMetaContent(t,"name","authorList")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(e,"copyrightHolder.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(e,"publisher.name")||this.getSchemaProperty(e,"sourceOrganization.name")||this.getSchemaProperty(e,"isPartOf.name")||this.getMetaContent(t,"name","twitter:creator")||this.getMetaContent(t,"name","application-name")||""}static getSite(t,e){return this.getSchemaProperty(e,"publisher.name")||this.getMetaContent(t,"property","og:site_name")||this.getSchemaProperty(e,"sourceOrganization.name")||this.getMetaContent(t,"name","copyright")||this.getSchemaProperty(e,"copyrightHolder.name")||this.getSchemaProperty(e,"isPartOf.name")||this.getMetaContent(t,"name","application-name")||""}static getTitle(t,e){var r,o;return this.getMetaContent(t,"property","og:title")||this.getMetaContent(t,"name","twitter:title")||this.getSchemaProperty(e,"headline")||this.getMetaContent(t,"name","title")||this.getMetaContent(t,"name","sailthru.title")||(null===(o=null===(r=t.querySelector("title"))||void 0===r?void 0:r.textContent)||void 0===o?void 0:o.trim())||""}static getDescription(t,e){return this.getMetaContent(t,"name","description")||this.getMetaContent(t,"property","description")||this.getMetaContent(t,"property","og:description")||this.getSchemaProperty(e,"description")||this.getMetaContent(t,"name","twitter:description")||this.getMetaContent(t,"name","sailthru.description")||""}static getImage(t,e){return this.getMetaContent(t,"property","og:image")||this.getMetaContent(t,"name","twitter:image")||this.getSchemaProperty(e,"image.url")||this.getMetaContent(t,"name","sailthru.image.full")||""}static getFavicon(t,e){var r,o;const n=this.getMetaContent(t,"property","og:image:favicon");if(n)return n;const a=null===(r=t.querySelector("link[rel='icon']"))||void 0===r?void 0:r.getAttribute("href");if(a)return a;const i=null===(o=t.querySelector("link[rel='shortcut icon']"))||void 0===o?void 0:o.getAttribute("href");if(i)return i;if(e)try{return new URL("/favicon.ico",e).href}catch(t){console.warn("Failed to construct favicon URL:",t)}return""}static getPublished(t,e){return this.getSchemaProperty(e,"datePublished")||this.getMetaContent(t,"name","publishDate")||this.getMetaContent(t,"property","article:published_time")||this.getTimeElement(t)||this.getMetaContent(t,"name","sailthru.date")||""}static getMetaContent(t,e,r){var o,n;const a=`meta[${e}]`,i=Array.from(t.querySelectorAll(a)).find((t=>{var o;return(null===(o=t.getAttribute(e))||void 0===o?void 0:o.toLowerCase())===r.toLowerCase()})),s=i&&null!==(n=null===(o=i.getAttribute("content"))||void 0===o?void 0:o.trim())&&void 0!==n?n:"";return this.decodeHTMLEntities(s)}static getTimeElement(t){var e,r,o,n;const a=Array.from(t.querySelectorAll("time"))[0],i=a&&null!==(n=null!==(r=null===(e=a.getAttribute("datetime"))||void 0===e?void 0:e.trim())&&void 0!==r?r:null===(o=a.textContent)||void 0===o?void 0:o.trim())&&void 0!==n?n:"";return this.decodeHTMLEntities(i)}static decodeHTMLEntities(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}static getSchemaProperty(t,e,r=""){if(!t)return r;const o=(t,e,r,n=!0)=>{if("string"==typeof t)return 0===e.length?[t]:[];if(!t||"object"!=typeof t)return[];if(Array.isArray(t)){const a=e[0];if(/^\[\d+\]$/.test(a)){const i=parseInt(a.slice(1,-1));return t[i]?o(t[i],e.slice(1),r,n):[]}return 0===e.length&&t.every((t=>"string"==typeof t||"number"==typeof t))?t.map(String):t.flatMap((t=>o(t,e,r,n)))}const[a,...i]=e;if(!a)return"string"==typeof t?[t]:"object"==typeof t&&t.name?[t.name]:[];if(t.hasOwnProperty(a))return o(t[a],i,r?`${r}.${a}`:a,!0);if(!n){const n=[];for(const a in t)if("object"==typeof t[a]){const i=o(t[a],e,r?`${r}.${a}`:a,!1);n.push(...i)}if(n.length>0)return n}return[]};try{let n=o(t,e.split("."),"",!0);0===n.length&&(n=o(t,e.split("."),"",!1));const a=n.length>0?n.filter(Boolean).join(", "):r;return this.decodeHTMLEntities(a)}catch(t){return console.error(`Error in getSchemaProperty for ${e}:`,t),r}}static extractSchemaOrgData(t){const e=t.querySelectorAll('script[type="application/ld+json"]'),r=[];return e.forEach((t=>{let e=t.textContent||"";try{e=e.replace(/\/\*[\s\S]*?\*\/|^\s*\/\/.*$/gm,"").replace(/^\s*<!\[CDATA\[([\s\S]*?)\]\]>\s*$/,"$1").replace(/^\s*(\*\/|\/\*)\s*|\s*(\*\/|\/\*)\s*$/g,"").trim();const t=JSON.parse(e);t["@graph"]&&Array.isArray(t["@graph"])?r.push(...t["@graph"]):r.push(t)}catch(t){console.error("Error parsing schema.org data:",t),console.error("Problematic JSON content:",e)}})),r}}var r,o,n,a,i=function(t,e,r,o){if("a"===r&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?o:"a"===r?o.call(t):o?o.value:e.get(t)};const s=/article|content|main|post|body|text|blog|story/i,l=/comment|meta|footer|footnote|foot|nav|sidebar|banner|ad|popup|menu/i,c=["div","section","article","main"],m=["[hidden]",'[style*="display: none"]','[style*="display:none"]','[style*="visibility: hidden"]','[style*="visibility:hidden"]',".hidden",".invisible"].join(","),h=new Set(["href","src","srcset","data-src","data-srcset","alt","title","id","class","width","height","colspan","rowspan","headers","aria-label","role","lang"]),d=["#toc",".toc","#comments","#siteSub",".ad","aside","button","canvas","dialog","fieldset","footer","form","header","input","iframe","label","link","nav","noscript","option","script","select","sidebar",".sidebar","#sidebar","style","textarea",'[data-link-name*="skip"]','[src*="author"]','[href="#site-content"]','[class^="ad-"]','[class$="-ad"]','[id^="ad-"]','[id$="-ad"]','[role="banner"]','[role="dialog"]','[role="complementary"]','[role="navigation"]'],u=["avatar","-ad-","_ad_","article-end ","article-title","author","banner","bottom-of-article","brand-bar","breadcrumb","button","btn-","-btn","byline","catlinks","collections","comments","comment-content","complementary","-cta","cta-","discussion","eyebrow","expand-reduce","facebook","feedback","fixed","footer","for-you","global","google","goog-","interlude","link-box","loading","logo-","menu-","meta-","metadata","more-","mw-editsection","mw-jump-link","nav-","navbar","next-","newsletter-signup","overlay","popular","popup","post-date","post-title","post_date","post_title","preview","prevnext","profile","promo","qr-code","qr_code","read-next","reading-list","recommend","recirc","register","related","screen-reader-text","share","site-index","skip-","social","sponsor","subscribe","-toc","table-of-contents","tabs-","toolbar","top-wrapper","tree-item","trending","twitter"];class g{static enableDebug(t=!0){!function(t,e,r,o,n){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===o?n.call(t,r):n?n.value=r:e.set(t,r)}(this,r,t,"f",o)}static parse(t){try{const o=i(this,r,"m",a).call(this,t),n=this.findSmallImages(t),s=t.cloneNode(!0),l=e.extractSchemaOrgData(t);this.applyMobileStyles(s,o);const c=this.findMainContent(s);if(!c)return Object.assign({content:t.body.innerHTML},e.extract(t,l));this.removeSmallImages(s,n),this.removeHiddenElements(s),this.removeClutter(s),this.cleanContent(c);const m=e.extract(t,l);return Object.assign({content:c?c.outerHTML:t.body.innerHTML},m)}catch(r){console.error("Defuddle","Error processing document:",r);const o=e.extractSchemaOrgData(t);return Object.assign({content:t.body.innerHTML},e.extract(t,o))}}static applyMobileStyles(t,e){e.forEach((({selector:e,styles:r})=>{try{t.querySelectorAll(e).forEach((t=>{t.setAttribute("style",(t.getAttribute("style")||"")+r)}))}catch(t){console.error("Defuddle","Error applying styles for selector:",e,t)}}))}static removeHiddenElements(t){let e=0;t.querySelectorAll(m).forEach((t=>{t.remove(),e++}));const o=t.getElementsByTagName("*");Array.from(o).forEach((t=>{const r=window.getComputedStyle(t);"none"!==r.display&&"hidden"!==r.visibility&&"0"!==r.opacity||(t.remove(),e++)})),i(this,r,"m",n).call(this,"Removed hidden elements:",e)}static removeClutter(t){let e=0,o=0;const a=d.map((t=>t.includes("[")?t.split(/(\[.*?\])/).map((t=>{if(t.startsWith("[")&&t.includes("=")){const[e,r]=t.slice(1,-1).split("=");if(r.startsWith('"')||r.startsWith("'"))return`[${e.toLowerCase()}=${r}]`}return t.toLowerCase()})).join(""):t.toLowerCase())).join(",");t.querySelectorAll(a).forEach((t=>{(null==t?void 0:t.parentNode)&&(t.remove(),e++)}));const s=u.map((t=>new RegExp(t,"i"))),l=new Set;t.querySelectorAll("[class], [id], [data-testid], [data-qa]").forEach((t=>{var e,r;if(!t||!t.parentNode)return;const n=`${t.className&&"string"==typeof t.className?t.className.toLowerCase():""} ${t.id?t.id.toLowerCase():""} ${(null===(e=t.getAttribute("data-testid"))||void 0===e?void 0:e.toLowerCase())||""} ${(null===(r=t.getAttribute("data-qa"))||void 0===r?void 0:r.toLowerCase())||""}`;s.some((t=>t.test(n)))&&(l.add(t),o++)})),l.forEach((t=>t.remove())),i(this,r,"m",n).call(this,"Found clutter elements:",{basicSelectors:e,patternMatches:o,total:e+o})}static cleanContent(t){this.removeHtmlComments(t),this.handleHeadings(t),this.stripUnwantedAttributes(t),this.removeEmptyElements(t)}static handleHeadings(t){const e=t.getElementsByTagName("h1");let r=!0;Array.from(e).forEach((t=>{var e;if(r)t.remove(),r=!1;else{const r=document.createElement("h2");r.innerHTML=t.innerHTML,Array.from(t.attributes).forEach((t=>{h.has(t.name)&&r.setAttribute(t.name,t.value)})),null===(e=t.parentNode)||void 0===e||e.replaceChild(r,t)}}))}static removeHtmlComments(t){const e=[],o=document.createTreeWalker(t,NodeFilter.SHOW_COMMENT,null);let a;for(;a=o.nextNode();)e.push(a);e.forEach((t=>{t.remove()})),i(this,r,"m",n).call(this,"Removed HTML comments:",e.length)}static stripUnwantedAttributes(t){let e=0;const o=t=>{Array.from(t.attributes).forEach((r=>{const o=r.name.toLowerCase();h.has(o)||o.startsWith("data-")||(t.removeAttribute(r.name),e++)}))};o(t),t.querySelectorAll("*").forEach(o),i(this,r,"m",n).call(this,"Stripped attributes:",e)}static removeEmptyElements(t){let e=0,o=0,a=!0;const s=new Set(["area","audio","base","br","col","embed","figure","hr","iframe","img","input","link","meta","object","param","picture","source","svg","td","th","track","video","wbr"]);for(;a;){o++,a=!1;const r=Array.from(t.getElementsByTagName("*")).filter((t=>{var e;if(s.has(t.tagName.toLowerCase()))return!1;const r=0===(null===(e=t.textContent)||void 0===e?void 0:e.trim().length),o=!t.hasChildNodes()||Array.from(t.childNodes).every((t=>{var e;return t.nodeType===Node.TEXT_NODE&&0===(null===(e=t.textContent)||void 0===e?void 0:e.trim().length)}));return r&&o}));r.length>0&&(r.forEach((t=>{t.remove(),e++})),a=!0)}i(this,r,"m",n).call(this,"Removed empty elements:",{count:e,iterations:o})}static findSmallImages(t){let e=0;const o=new Set,a=t.getElementsByTagName("img");return Array.from(a).forEach((t=>{var r;try{const n=window.getComputedStyle(t),a=t.naturalWidth||0,i=t.naturalHeight||0,s=parseInt(t.getAttribute("width")||"0"),l=parseInt(t.getAttribute("height")||"0"),c=parseInt(n.width)||0,m=parseInt(n.height)||0,h=t.getBoundingClientRect(),d=h.width,u=h.height,g=n.transform,p=g?parseFloat((null===(r=g.match(/scale\(([\d.]+)\)/))||void 0===r?void 0:r[1])||"1"):1,f=d*p,y=u*p,v=Math.min(...[a,s,c,f].filter((t=>t>0))),b=Math.min(...[i,l,m,y].filter((t=>t>0)));if(v>0&&b>0&&(v<24||b<24)){const r=this.getImageIdentifier(t);r&&(o.add(r),e++)}}catch(t){console.error("Error processing image:",t)}})),i(this,r,"m",n).call(this,"Found small images:",e),o}static removeSmallImages(t,e){let o=0;const a=t.getElementsByTagName("img");Array.from(a).forEach((t=>{const r=this.getImageIdentifier(t);r&&e.has(r)&&(t.remove(),o++)})),i(this,r,"m",n).call(this,"Removed small images:",o)}static getImageIdentifier(t){const e=t.src||t.getAttribute("data-src")||"",r=t.srcset||t.getAttribute("data-srcset")||"",o=t.alt||"",n=t.className||"",a=t.id||"";return e?`src:${e}`:r?`srcset:${r}`:a?`id:${a}`:n&&o?`class:${n};alt:${o}`:null}static findMainContent(t){const e=["article",'[role="article"]','[itemprop="articleBody"]',".post-content",".article-content","#article-content",".content-article","main",'[role="main"]',"body"],a=[];return e.forEach(((r,o)=>{t.querySelectorAll(r).forEach((t=>{let r=10*(e.length-o);r+=this.scoreElement(t),a.push({element:t,score:r})}))})),0===a.length?this.findContentByScoring(t):(a.sort(((t,e)=>e.score-t.score)),i(this,r,"f",o)&&i(this,r,"m",n).call(this,"Content candidates:",a.map((t=>({element:t.element.tagName,selector:this.getElementSelector(t.element),score:t.score})))),a[0].element)}static findContentByScoring(t){const e=this.scoreElements(t);return e.length>0?e[0].element:null}static getElementSelector(t){const e=[];let r=t;for(;r&&r!==document.documentElement;){let t=r.tagName.toLowerCase();r.id?t+="#"+r.id:r.className&&(t+="."+r.className.trim().split(/\s+/).join(".")),e.unshift(t),r=r.parentElement}return e.join(" > ")}static scoreElements(t){const e=[];return c.forEach((r=>{Array.from(t.getElementsByTagName(r)).forEach((t=>{const r=this.scoreElement(t);r>0&&e.push({score:r,element:t})}))})),e.sort(((t,e)=>e.score-t.score))}static scoreElement(t){let e=0;const r=t.className.toLowerCase(),o=t.id.toLowerCase();(s.test(r)||s.test(o))&&(e+=25),(l.test(r)||l.test(o))&&(e-=25);const n=t.textContent||"",a=n.split(/\s+/).length;e+=Math.min(Math.floor(a/100),3);const i=t.getElementsByTagName("a"),c=Array.from(i).reduce(((t,e)=>{var r;return t+((null===(r=e.textContent)||void 0===r?void 0:r.length)||0)}),0);(n.length?c/n.length:0)>.5&&(e-=10),e+=t.getElementsByTagName("p").length;const m=t.getElementsByTagName("img").length;return e+=Math.min(3*m,9),e}}return r=g,n=function(...t){i(this,r,"f",o)&&console.log("Defuddle:",...t)},a=function(t){const e=[];try{Array.from(t.styleSheets).filter((t=>{try{return t.cssRules,!0}catch(t){return!1}})).forEach((t=>{try{Array.from(t.cssRules).forEach((t=>{var r;t instanceof CSSMediaRule&&t.conditionText.includes("max-width")&&600<=parseInt((null===(r=t.conditionText.match(/\d+/))||void 0===r?void 0:r[0])||"0")&&Array.from(t.cssRules).forEach((t=>{if(t instanceof CSSStyleRule)try{e.push({selector:t.selectorText,styles:t.style.cssText})}catch(e){console.error("Defuddle","Error collecting styles for selector:",t.selectorText,e)}}))}))}catch(t){console.error("Defuddle","Error processing stylesheet:",t)}}))}catch(t){console.error("Defuddle","Error evaluating media queries:",t)}return e},o={value:!1},window.Defuddle=g,t.default})()));